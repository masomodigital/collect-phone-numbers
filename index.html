<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Add Contact (Masomo) â€” Frontend</title>
  <style>
    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      padding: 24px;
      max-width: 680px;
      margin: auto;
      background: #f0f9ff;
      color: #1e293b;
    }
    h1 {
      color: #0c4a6e;
      text-align: center;
      margin-bottom: 0.2em;
    }
    p {
      font-size: 1.05em;
      color: #334155;
      margin-bottom: 1.2em;
      text-align: center;
    }
    label {
      display: block;
      margin-top: 16px;
      font-weight: 700;
      color: #0369a1;
    }
    input[type="text"], input[type="tel"] {
      width: 100%;
      padding: 12px;
      margin-top: 6px;
      box-sizing: border-box;
      border: 2px solid #7dd3fc;
      border-radius: 8px;
      font-size: 1em;
      transition: border-color 0.3s ease;
    }
    input[type="text"]:focus, input[type="tel"]:focus {
      outline: none;
      border-color: #0284c7;
      background: #e0f2fe;
    }
    button {
      margin-top: 24px;
      padding: 12px 20px;
      font-size: 18px;
      border-radius: 10px;
      cursor: pointer;
      background: #0284c7;
      color: white;
      border: none;
      width: 100%;
      font-weight: 700;
      box-shadow: 0 4px 8px rgb(2 132 199 / 0.3);
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
    }
    button:hover {
      background: #0369a1;
      box-shadow: 0 6px 12px rgb(3 105 161 / 0.5);
    }
    .ok {
      color: #065f46;
      background: #bbf7d0;
      padding: 12px;
      border-radius: 8px;
      margin-top: 16px;
      font-weight: 600;
      box-shadow: 0 1px 3px rgb(6 95 70 / 0.3);
    }
    .err {
      color: #991b1b;
      background: #fecaca;
      padding: 12px;
      border-radius: 8px;
      margin-top: 16px;
      font-weight: 600;
      box-shadow: 0 1px 3px rgb(153 27 27 / 0.3);
    }
    .note {
      margin-top: 20px;
      font-size: 0.9em;
      color: #475569;
      text-align: center;
      user-select: all;
    }
    code {
      background: #e0e7ff;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 0.95em;
    }
  </style>
</head>
<body>
  <h1>Add Contact</h1>
  <p>Enter National ID, Name and Phone Number. The app will add the contact only if the National ID exists in the <strong>Users</strong> sheet.</p>

  <label for="nationalId">National ID or User ID</label>
  <input id="nationalId" type="text" placeholder="e.g. 12345678" />

  <label for="name">Name</label>
  <input id="name" type="text" placeholder="Full name" />

  <label for="phone">Phone Number - Safaricom ONLY</label>
  <input id="phone" type="tel" placeholder="07XXXXXXXX" maxlength="10" pattern="\d{10}" />

  <button id="sendBtn">Add Contact</button>

  <div id="msg"></div>

  <p class="note">
    Note: Share this form with your friends to submit their contacts to your database. Ensure you give them your correct User ID.
  </p>

  <script>
    // ---- SET THIS to your deployed web app URL ----
    const WEB_APP_URL = "https://throbbing-mouse-d4be.ev-dmaundu.workers.dev/";
    // ----------------------------------------------

    const sendBtn = document.getElementById("sendBtn");
    const msg = document.getElementById("msg");

    function showMessage(text, isError) {
      msg.innerHTML = "";
      const d = document.createElement("div");
      d.className = isError ? "err" : "ok";
      d.textContent = text;
      msg.appendChild(d);
    }

    async function addContact(nationalId, name, phone) {
      try {
        const payload = { nationalId, name, phone };

        const resp = await fetch(WEB_APP_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(payload)
        });

        const data = await resp.json();

        if (!resp.ok) {
          showMessage((data && data.error) ? data.error : "Server error", true);
          return;
        }

        if (data.success) {
          showMessage("Contact added successfully: " + (data.data ? data.data.timestamp : ""), false);
          // Clear form
          document.getElementById("nationalId").value = "";
          document.getElementById("name").value = "";
          document.getElementById("phone").value = "";
        } else {
          showMessage((data && data.error) ? data.error : "Failed to add contact", true);
        }
      } catch (err) {
        showMessage("Request failed: " + err.message + ". Check the WEB_APP_URL, network and CORS settings.", true);
      }
    }

    sendBtn.addEventListener("click", function() {
      const nationalId = document.getElementById("nationalId").value.trim();
      const name = document.getElementById("name").value.trim();
      const phone = document.getElementById("phone").value.trim();

      if (!nationalId) return showMessage("National ID is required", true);
      if (!name) return showMessage("Name is required", true);
      if (!/^\d{10}$/.test(phone)) return showMessage("Phone number must be exactly 10 digits (numbers only)", true);

      showMessage("Sending...", false);
      addContact(nationalId, name, phone);
    });
  </script>
</body>
</html>
