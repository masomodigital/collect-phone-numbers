<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Add Contact (Masomo) â€” Frontend</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; padding: 24px; max-width: 680px; margin: auto; }
    label { display:block; margin-top:12px; font-weight:600; }
    input[type="text"], input[type="tel"] { width:100%; padding:10px; margin-top:6px; box-sizing:border-box; }
    button { margin-top:16px; padding:10px 14px; font-size:16px; border-radius:8px; cursor:pointer; }
    .ok { color: #064e3b; background: #bbf7d0; padding:10px; border-radius:6px; margin-top:12px; }
    .err { color: #7f1d1d; background:#fecaca; padding:10px; border-radius:6px; margin-top:12px; }
    .note { margin-top:8px; font-size:0.9em; color:#374151; }
  </style>
</head>
<body>
  <h1>Add Contact</h1>
  <p>Enter National ID, Name and Phone Number. The app will add the contact only if the National ID exists in the <strong>Users</strong> sheet.</p>

  <label for="nationalId">National ID</label>
  <input id="nationalId" type="text" placeholder="e.g. 12345678" />

  <label for="name">Name</label>
  <input id="name" type="text" placeholder="Full name" />

  <label for="phone">Phone Number</label>
  <input id="phone" type="tel" placeholder="07XXXXXXXX" />

  <button id="sendBtn">Add Contact</button>

  <div id="msg"></div>

  <p class="note">
    Note: Replace <code>WEB_APP_URL</code> below with your deployed Google Apps Script Web App URL.
  </p>

  <script>
    // ---- SET THIS to your deployed web app URL ----
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxoRsOJaNtcyh7n52A8FXNhJNIvE1hDEjYCjEds1ZKOPV_t0aukWJeOztltK2GxoZs/exec";
    // ----------------------------------------------

    const sendBtn = document.getElementById("sendBtn");
    const msg = document.getElementById("msg");

    function showMessage(text, isError) {
      msg.innerHTML = "";
      const d = document.createElement("div");
      d.className = isError ? "err" : "ok";
      d.textContent = text;
      msg.appendChild(d);
    }

    async function addContact(nationalId, name, phone) {
      try {
        const payload = { nationalId, name, phone };

        const resp = await fetch(WEB_APP_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(payload)
        });

        // If the server returns non-JSON or blocked by CORS, this will throw
        const data = await resp.json();

        if (!resp.ok) {
          showMessage((data && data.error) ? data.error : "Server error", true);
          return;
        }

        if (data.success) {
          showMessage("Contact added successfully: " + (data.data ? data.data.timestamp : ""), false);
          // Clear form
          document.getElementById("nationalId").value = "";
          document.getElementById("name").value = "";
          document.getElementById("phone").value = "";
        } else {
          showMessage((data && data.error) ? data.error : "Failed to add contact", true);
        }
      } catch (err) {
        // Common cause: CORS or network / wrong URL
        showMessage("Request failed: " + err.message + ". Check the WEB_APP_URL, network and CORS settings.", true);
      }
    }

    sendBtn.addEventListener("click", function() {
      const nationalId = document.getElementById("nationalId").value.trim();
      const name = document.getElementById("name").value.trim();
      const phone = document.getElementById("phone").value.trim();

      if (!nationalId) return showMessage("National ID is required", true);
      if (!name) return showMessage("Name is required", true);
      if (!phone) return showMessage("Phone is required", true);

      showMessage("Sending...", false);
      addContact(nationalId, name, phone);
    });

  </script>
</body>
</html>
